{% extends "base.html" %}
{% load utils %}

{% block head %}
    {% load_css "navigation" %}
    {% load_css "files/file_viewer" %}

    <script>
        function api_url(api, path) {
            return "{% url "private:ffs" %}" + api + "/" + encodeURIComponent(path)
        }

        folders = [
            {% for f in folders %}
                "{{ f|escapejs }}",
            {% endfor %}];
        files = [
            {% for f in files %}
                "{{ f|escapejs }}",
            {% endfor %}];
    </script>
{% endblock %}

{% block content %}
    <!--<div id="path-view">

    </div>
    <input id="auto-reload" type="checkbox" checked>
    <label for="auto-reload">Auto Reload</label>
    <table id="file-view-container">
        <tr>
            <td style="display: flex">
                <table id="file-view">

                </table>
            </td>
            <td>
                <div id="file-drop-area">
                    Drop files here
                </div>
            </td>
        </tr>
    </table>
    <div>
        <a id="download-link">Download directory (zip)</a>
        <div id="error-msg"></div>
    </div>-->

    <h1 style="margin-bottom: 0;">
        Hello, {{ request.user }}
    </h1>
    <span><button onclick="select_tab('file-view-container')">View</button>
          <button onclick="select_tab('upload-container')">Upload</button></span>

    <table id="file-view-container" class="tab-container">
        <tr>
            <td style="display: flex">
                <table id="file-view">
                    <thead>
                    <tr>
                        <th></th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Size</th>
                        <th></th>
                    </tr>
                    <tr class="thin-row">
                        <th class="thin-row" colspan="5" style="text-align: left">Buttons go here</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for f in folders %}
                        <tr>
                            <td><span class="icon">üìÅ</span></td>
                            <td><a href="{% url "private:api" "files" f %}">{{ f.name }}</a></td>
                            <td>Folder</td>
                            <td></td>
                            <td></td>
                        </tr>
                    {% endfor %}
                    {% for f in files %}
                        <tr>
                            <td id="icon-{{ f.name|base64e }}"></td>
                            <td><a href="{% url "private:api" "files" f %}">{{ f.name }}</a></td>
                            <td id="type-{{ f.name|base64e }}"></td>
                            <td id="size-{{ f.name|base64e }}"></td>
                            <td></td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </td>
            <!--<td>
                <div id="file-drop-area">
                    Drop files here
                </div>
            </td>-->
        </tr>
    </table>
    <div id="upload-container" class="tab-container" style="display:none; margin-top: 20px">
        <label for="file-input">
            File input:
        </label>
        <input id="file-input" type="file">
        <label for="upload-output">
            Drag files here to upload/Upload Output:
        </label>
        <textarea id="upload-output"
                  style="display:block; width: 100%; height: 50vh" contenteditable="false">To upload files, drag them here</textarea>
    </div>

    {% load_js "files/add_metadata" extra_args="async" %}

    <script>
        function select_tab(id) {
            document.querySelectorAll(".tab-container").forEach(el => {
                el.style.display = "none";
            })

            document.getElementById(id).style.display = "block";
        }
    </script>
    <style>
        #upload-container > * {
            display: block;
        }
    </style>
{% endblock %}